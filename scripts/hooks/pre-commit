#!/bin/bash
# Git pre-commit hook - Runs ruff check and format before allowing commit

echo "üîç Running ruff checks on staged Python files..."

# Get list of staged Python files
PYTHON_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.pyi?$' || true)

if [ -z "$PYTHON_FILES" ]; then
    echo "‚úì No Python files to check"
    exit 0
fi

echo "Checking files:"
echo "$PYTHON_FILES" | sed 's/^/  - /'
echo ""

# Run ruff check on staged files
echo "1Ô∏è‚É£ Running ruff check..."
if ! uv run ruff check $PYTHON_FILES; then
    echo ""
    echo "‚ùå Ruff check failed!"
    echo ""
    echo "Fix the errors above or:"
    echo "  - Run: uv run ruff check --fix src/"
    echo "  - Skip hook: git commit --no-verify"
    exit 1
fi
echo "‚úì Ruff check passed!"
echo ""

# Run ruff format check on staged files
echo "2Ô∏è‚É£ Running ruff format check..."
if ! uv run ruff format --check $PYTHON_FILES; then
    echo ""
    echo "‚ùå Ruff format check failed!"
    echo ""
    echo "Fix the formatting:"
    echo "  - Run: uv run ruff format src/"
    echo "  - Skip hook: git commit --no-verify"
    exit 1
fi
echo "‚úì Ruff format check passed!"
echo ""

echo "üéâ All checks passed!"
exit 0
